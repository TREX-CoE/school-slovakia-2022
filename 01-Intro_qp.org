#+TITLE: Introduction to Quantum Package
#+AUTHOR: Anthony Scemama
#+LANGUAGE:  en
#+HTML_LINK_HOME: index.html
#+HTML_LINK_UP: index.html
#+SETUPFILE: org-html-themes/org/theme-readtheorg-local.setup


#+ATTR_HTML: :width 100px
#+ATTR_LATEX: :width 100px
  [[./images/QP.png]]

* Environment
  
  Quantum Package (QP) is an open-source environment for developing
  easily quantum chemistry programs. It was initially designed for code
  developers, but it is relatively simple to use.


  Before doing anything with quantum package, the environment needs to
  be set up
  #+begin_src bash
source $QP_ROOT/quantum_package.rc
  #+end_src
  where =$QP_ROOT= is the path to the $qp2$ directory.

  An alternative, when using QP interactively is to run the QP shell:
  #+begin_src 
$QP_ROOT/bin/qpsh
  #+end_src

* The EZFIO database

  QP stores input and output data in a database, called the /EZFIO directory/.
  To interact with the database, QP provides multiple shell functions,
  scripts and programs.

  Let us take an example to show how to use QP. First, we need to
  create a file with a geometry in =xyz= or =z-matrix= format. Let us
  take the water molecule, and write the coordinates in the file
  =h2o.xyz=:
  
   #+begin_src text :tangle h2o.xyz
3                                                                                            
Water
O       0.                     0.   0.
H      -0.756950272703377558   0.  -0.585882234512562827
H       0.756950272703377558   0.  -0.585882234512562827

   #+end_src

   We can now create an EZFIO database containing the geometry and the
   basis set parameters for the cc-pVDZ basis set:

   #+begin_src 
qp create_ezfio --basis=cc-pvdz h2o.xyz
   #+end_src

   A directory named =h2o.ezfio= has been created. When running
   interactively with qpsh, the current EZFIO database is displayed in
   the terminal. You should see =|h2o.ezfio>= in green before the
   command line. If you change directory, =|h2o.ezfio>= will become
   red, meaning that the EZFIO database in inaccessible. To change
   EZFIO database, use
   #+begin_src 
qp set_file other.ezfio
   #+end_src

* =qp= commands

   To get the documentation of the =qp= command, you can use
   #+begin_src bash
qp --help
   #+end_src

   Note: all QP commands come with a =--help= option for documentaion.

   To run a Hartree-Fock calculation, we will run the =scf= program of
   QP. To run a QP program, use =qp run=:

   #+begin_src 
qp run scf | tee h2o.scf.out
   #+end_src

   Here, we have copied the standard output into the file
   =h2o.scf.out= using the =tee= linux command.
   The Hartree-Fock orbitals are now stored inside the EZFIO
   database. If you run again the =scf= code, you will notice that the
   SCF will converge in a single iteration because it takes the MOs
   inside the database as an initial guess.

   Now we have a set of Hartree-Fock orbitals, we can run a CISD. But
   we don't want to include the single- and double-excitations from
   the $1s$ orbitals. For that, we need to run
   #+begin_src 
qp set_frozen_core
   #+end_src

   The output of this command tells that orbital 1 is labelled as
   =Core= and orbitals 2-24 are labelled as =Active=.
   We can now run the CISD
   #+begin_src 
qp run cisd | tee h2o.cisd.out
   #+end_src
   
   To modify the input parameters of the programs, you can use =qp edit=.
   This will open a temporary file with the editor defined by the
   =$EDITOR= environment variable, that you can modify to change the parameters.

   Alternatively, all the input parameters can be inspected using =qp
   get=, for example:
   #+begin_src 
qp get determinants n_det_max
   #+end_src
   and set using =qp set=
   #+begin_src 
qp set determinants n_det_max 2000
   #+end_src

   Note: You can use Tab-completion with the =qp= command, which makes
   the shell interaction more user-friendly.
   
